                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.5.2 #9293 (MINGW32)
                              4 ; This file was generated Tue Nov 13 17:35:20 2018
                              5 ;--------------------------------------------------------
                              6 	.module tile_chac_chac
                              7 	.optsdcc -mz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl _map_set
                             13 	.globl _PSGSFXPlay
                             14 	.globl _chac_chacs_add
                             15 	.globl _chac_chacs_do
                             16 ;--------------------------------------------------------
                             17 ; special function registers
                             18 ;--------------------------------------------------------
                             19 ;--------------------------------------------------------
                             20 ; ram data
                             21 ;--------------------------------------------------------
                             22 	.area _DATA
                             23 ;--------------------------------------------------------
                             24 ; ram data
                             25 ;--------------------------------------------------------
                             26 	.area _INITIALIZED
                             27 ;--------------------------------------------------------
                             28 ; absolute external ram data
                             29 ;--------------------------------------------------------
                             30 	.area _DABS (ABS)
                             31 ;--------------------------------------------------------
                             32 ; global & static initialisations
                             33 ;--------------------------------------------------------
                             34 	.area _HOME
                             35 	.area _GSINIT
                             36 	.area _GSFINAL
                             37 	.area _GSINIT
                             38 ;--------------------------------------------------------
                             39 ; Home
                             40 ;--------------------------------------------------------
                             41 	.area _HOME
                             42 	.area _HOME
                             43 ;--------------------------------------------------------
                             44 ; code
                             45 ;--------------------------------------------------------
                             46 	.area _CODE
                             47 ;engine/tile_chac_chac.c:29: void chac_chacs_add (void) {
                             48 ;	---------------------------------
                             49 ; Function chac_chacs_add
                             50 ; ---------------------------------
   0000                      51 _chac_chacs_add::
                             52 ;engine/tile_chac_chac.c:31: if (max_chac_chacs == MAX_CHAC_CHACS) return;
   0000 3Ar00r00      [13]   53 	ld	a,(#_max_chac_chacs + 0)
   0003 D6 04         [ 7]   54 	sub	a, #0x04
   0005 C8            [11]   55 	ret	Z
   0006 18 00         [12]   56 	jr	00102$
   0008                      57 00102$:
                             58 ;engine/tile_chac_chac.c:32: rdc = chac_chacs_initial_times [rdt - CHAC_CHAC_DETECT_TILE];
   0008 3Ar00r00      [13]   59 	ld	a,(#_rdt + 0)
   000B 26 00         [ 7]   60 	ld	h, #0x00
   000D C6 E8         [ 7]   61 	add	a,#0xE8
   000F 6F            [ 4]   62 	ld	l,a
   0010 7C            [ 4]   63 	ld	a,h
   0011 CE FF         [ 7]   64 	adc	a,#0xFF
   0013 67            [ 4]   65 	ld	h,a
   0014 11r00r00      [10]   66 	ld	de,#_chac_chacs_initial_times
   0017 19            [11]   67 	add	hl,de
   0018 7E            [ 7]   68 	ld	a,(hl)
   0019 32r00r00      [13]   69 	ld	(#_rdc + 0),a
                             70 ;engine/tile_chac_chac.c:34: chac_chacs_yx [max_chac_chacs] = rdm;
   001C 11r00r00      [10]   71 	ld	de,#_chac_chacs_yx+0
   001F 2Ar00r00      [16]   72 	ld	hl,(_max_chac_chacs)
   0022 26 00         [ 7]   73 	ld	h,#0x00
   0024 19            [11]   74 	add	hl,de
   0025 3Ar00r00      [13]   75 	ld	a,(#_rdm + 0)
   0028 77            [ 7]   76 	ld	(hl),a
                             77 ;engine/tile_chac_chac.c:35: chac_chacs_state [max_chac_chacs] = 0;
   0029 11r00r00      [10]   78 	ld	de,#_chac_chacs_state+0
   002C 2Ar00r00      [16]   79 	ld	hl,(_max_chac_chacs)
   002F 26 00         [ 7]   80 	ld	h,#0x00
   0031 19            [11]   81 	add	hl,de
   0032 36 00         [10]   82 	ld	(hl),#0x00
                             83 ;engine/tile_chac_chac.c:36: chac_chacs_idlewait [max_chac_chacs] = rdc;
   0034 11r00r00      [10]   84 	ld	de,#_chac_chacs_idlewait+0
   0037 2Ar00r00      [16]   85 	ld	hl,(_max_chac_chacs)
   003A 26 00         [ 7]   86 	ld	h,#0x00
   003C 19            [11]   87 	add	hl,de
   003D 3Ar00r00      [13]   88 	ld	a,(#_rdc + 0)
   0040 77            [ 7]   89 	ld	(hl),a
                             90 ;engine/tile_chac_chac.c:37: chac_chacs_ct [max_chac_chacs] = rdc;
   0041 11r00r00      [10]   91 	ld	de,#_chac_chacs_ct+0
   0044 2Ar00r00      [16]   92 	ld	hl,(_max_chac_chacs)
   0047 26 00         [ 7]   93 	ld	h,#0x00
   0049 19            [11]   94 	add	hl,de
   004A 3Ar00r00      [13]   95 	ld	a,(#_rdc + 0)
   004D 77            [ 7]   96 	ld	(hl),a
                             97 ;engine/tile_chac_chac.c:39: ++ max_chac_chacs;
   004E 21r00r00      [10]   98 	ld	hl, #_max_chac_chacs+0
   0051 34            [11]   99 	inc	(hl)
   0052 C9            [10]  100 	ret
                            101 ;engine/tile_chac_chac.c:42: void chac_chacs_do (void) {
                            102 ;	---------------------------------
                            103 ; Function chac_chacs_do
                            104 ; ---------------------------------
   0053                     105 _chac_chacs_do::
   0053 DD E5         [15]  106 	push	ix
   0055 DD 21 00 00   [14]  107 	ld	ix,#0
   0059 DD 39         [15]  108 	add	ix,sp
   005B F5            [11]  109 	push	af
                            110 ;engine/tile_chac_chac.c:43: gpit = max_chac_chacs; while (gpit --) {
   005C 3Ar00r00      [13]  111 	ld	a,(#_max_chac_chacs + 0)
   005F 32r00r00      [13]  112 	ld	(#_gpit + 0),a
   0062                     113 00106$:
   0062 FD 21r00r00   [14]  114 	ld	iy,#_gpit
   0066 FD 56 00      [19]  115 	ld	d,0 (iy)
   0069 FD 21r00r00   [14]  116 	ld	iy,#_gpit
   006D FD 35 00      [23]  117 	dec	0 (iy)
   0070 7A            [ 4]  118 	ld	a,d
   0071 B7            [ 4]  119 	or	a, a
   0072 CAr0Br01      [10]  120 	jp	Z,00108$
                            121 ;engine/tile_chac_chac.c:44: if (chac_chacs_ct [gpit]) -- chac_chacs_ct [gpit]; else {
   0075 3Ar00r00      [13]  122 	ld	a,(#_gpit + 0)
   0078 C6r00         [ 7]  123 	add	a, #<(_chac_chacs_ct)
   007A DD 77 FE      [19]  124 	ld	-2 (ix),a
   007D 3E 00         [ 7]  125 	ld	a,#0x00
   007F CEs00         [ 7]  126 	adc	a, #>(_chac_chacs_ct)
   0081 DD 77 FF      [19]  127 	ld	-1 (ix),a
   0084 E1            [10]  128 	pop	hl
   0085 E5            [11]  129 	push	hl
   0086 7E            [ 7]  130 	ld	a,(hl)
   0087 B7            [ 4]  131 	or	a, a
   0088 28 07         [12]  132 	jr	Z,00104$
   008A C6 FF         [ 7]  133 	add	a,#0xFF
   008C E1            [10]  134 	pop	hl
   008D E5            [11]  135 	push	hl
   008E 77            [ 7]  136 	ld	(hl),a
   008F 18 D1         [12]  137 	jr	00106$
   0091                     138 00104$:
                            139 ;engine/tile_chac_chac.c:45: ++ chac_chacs_state [gpit];
   0091 3Er00         [ 7]  140 	ld	a,#<(_chac_chacs_state)
   0093 21r00r00      [10]  141 	ld	hl,#_gpit
   0096 86            [ 7]  142 	add	a, (hl)
   0097 5F            [ 4]  143 	ld	e,a
   0098 3Es00         [ 7]  144 	ld	a,#>(_chac_chacs_state)
   009A CE 00         [ 7]  145 	adc	a, #0x00
   009C 57            [ 4]  146 	ld	d,a
   009D 1A            [ 7]  147 	ld	a,(de)
   009E 3C            [ 4]  148 	inc	a
   009F 12            [ 7]  149 	ld	(de),a
                            150 ;engine/tile_chac_chac.c:46: if (chac_chacs_state [gpit] == CHAC_CHAC_MAX_STATES) chac_chacs_state [gpit] = 0;
   00A0 3Er00         [ 7]  151 	ld	a,#<(_chac_chacs_state)
   00A2 21r00r00      [10]  152 	ld	hl,#_gpit
   00A5 86            [ 7]  153 	add	a, (hl)
   00A6 5F            [ 4]  154 	ld	e,a
   00A7 3Es00         [ 7]  155 	ld	a,#>(_chac_chacs_state)
   00A9 CE 00         [ 7]  156 	adc	a, #0x00
   00AB 57            [ 4]  157 	ld	d,a
   00AC 1A            [ 7]  158 	ld	a,(de)
   00AD D6 06         [ 7]  159 	sub	a, #0x06
   00AF 20 02         [12]  160 	jr	NZ,00102$
   00B1 AF            [ 4]  161 	xor	a, a
   00B2 12            [ 7]  162 	ld	(de),a
   00B3                     163 00102$:
                            164 ;engine/tile_chac_chac.c:47: chac_chacs_ct [gpit] = chac_chacs_state [gpit] ? 
   00B3 3Er00         [ 7]  165 	ld	a,#<(_chac_chacs_ct)
   00B5 21r00r00      [10]  166 	ld	hl,#_gpit
   00B8 86            [ 7]  167 	add	a, (hl)
   00B9 4F            [ 4]  168 	ld	c,a
   00BA 3Es00         [ 7]  169 	ld	a,#>(_chac_chacs_ct)
   00BC CE 00         [ 7]  170 	adc	a, #0x00
   00BE 47            [ 4]  171 	ld	b,a
   00BF FD 21r00r00   [14]  172 	ld	iy,#_chac_chacs_state
   00C3 ED 5Br00r00   [20]  173 	ld	de,(_gpit)
   00C7 16 00         [ 7]  174 	ld	d,#0x00
   00C9 FD 19         [15]  175 	add	iy, de
   00CB FD 5E 00      [19]  176 	ld	e, 0 (iy)
   00CE 7B            [ 4]  177 	ld	a,e
   00CF B7            [ 4]  178 	or	a, a
   00D0 28 09         [12]  179 	jr	Z,00115$
                            180 ;engine/tile_chac_chac.c:48: (chac_chacs_times [chac_chacs_state [gpit]]) :
   00D2 21r00r00      [10]  181 	ld	hl,#_chac_chacs_times
   00D5 16 00         [ 7]  182 	ld	d,#0x00
   00D7 19            [11]  183 	add	hl, de
   00D8 7E            [ 7]  184 	ld	a,(hl)
   00D9 18 0F         [12]  185 	jr	00116$
   00DB                     186 00115$:
                            187 ;engine/tile_chac_chac.c:49: chac_chacs_idlewait [gpit];
   00DB FD 21r00r00   [14]  188 	ld	iy,#_chac_chacs_idlewait
   00DF ED 5Br00r00   [20]  189 	ld	de,(_gpit)
   00E3 16 00         [ 7]  190 	ld	d,#0x00
   00E5 FD 19         [15]  191 	add	iy, de
   00E7 FD 7E 00      [19]  192 	ld	a, 0 (iy)
   00EA                     193 00116$:
   00EA 02            [ 7]  194 	ld	(bc),a
                            195 ;engine/tile_chac_chac.c:52: chac_chacs_queue [chac_chacs_queue_write] = gpit;
   00EB 3Er00         [ 7]  196 	ld	a,#<(_chac_chacs_queue)
   00ED 21r00r00      [10]  197 	ld	hl,#_chac_chacs_queue_write
   00F0 86            [ 7]  198 	add	a, (hl)
   00F1 5F            [ 4]  199 	ld	e,a
   00F2 3Es00         [ 7]  200 	ld	a,#>(_chac_chacs_queue)
   00F4 CE 00         [ 7]  201 	adc	a, #0x00
   00F6 57            [ 4]  202 	ld	d,a
   00F7 3Ar00r00      [13]  203 	ld	a,(#_gpit + 0)
   00FA 12            [ 7]  204 	ld	(de),a
                            205 ;engine/tile_chac_chac.c:53: chac_chacs_queue_write = (chac_chacs_queue_write + 1) & (MAX_CHAC_CHACKS_QUEUED-1);
   00FB 3Ar00r00      [13]  206 	ld	a,(#_chac_chacs_queue_write + 0)
   00FE 3C            [ 4]  207 	inc	a
   00FF E6 0F         [ 7]  208 	and	a, #0x0F
   0101 FD 21r00r00   [14]  209 	ld	iy,#_chac_chacs_queue_write
   0105 FD 77 00      [19]  210 	ld	0 (iy),a
   0108 C3r62r00      [10]  211 	jp	00106$
   010B                     212 00108$:
                            213 ;engine/tile_chac_chac.c:57: if (chac_chacs_queue_write != chac_chacs_queue_read) {
   010B 3Ar00r00      [13]  214 	ld	a,(#_chac_chacs_queue_write + 0)
   010E FD 21r00r00   [14]  215 	ld	iy,#_chac_chacs_queue_read
   0112 FD 96 00      [19]  216 	sub	a, 0 (iy)
   0115 CArCBr01      [10]  217 	jp	Z,00113$
                            218 ;engine/tile_chac_chac.c:58: gpit = chac_chacs_queue [chac_chacs_queue_read];
   0118 3Er00         [ 7]  219 	ld	a,#<(_chac_chacs_queue)
   011A 21r00r00      [10]  220 	ld	hl,#_chac_chacs_queue_read
   011D 86            [ 7]  221 	add	a, (hl)
   011E 5F            [ 4]  222 	ld	e,a
   011F 3Es00         [ 7]  223 	ld	a,#>(_chac_chacs_queue)
   0121 CE 00         [ 7]  224 	adc	a, #0x00
   0123 57            [ 4]  225 	ld	d,a
   0124 1A            [ 7]  226 	ld	a,(de)
   0125 32r00r00      [13]  227 	ld	(#_gpit + 0),a
                            228 ;engine/tile_chac_chac.c:59: chac_chacs_queue_read = (chac_chacs_queue_read + 1) & (MAX_CHAC_CHACKS_QUEUED-1);
   0128 3Ar00r00      [13]  229 	ld	a,(#_chac_chacs_queue_read + 0)
   012B 3C            [ 4]  230 	inc	a
   012C E6 0F         [ 7]  231 	and	a, #0x0F
   012E 32r00r00      [13]  232 	ld	(#_chac_chacs_queue_read + 0),a
                            233 ;engine/tile_chac_chac.c:60: rdm = chac_chacs_state [gpit];
   0131 3Er00         [ 7]  234 	ld	a,#<(_chac_chacs_state)
   0133 21r00r00      [10]  235 	ld	hl,#_gpit
   0136 86            [ 7]  236 	add	a, (hl)
   0137 5F            [ 4]  237 	ld	e,a
   0138 3Es00         [ 7]  238 	ld	a,#>(_chac_chacs_state)
   013A CE 00         [ 7]  239 	adc	a, #0x00
   013C 57            [ 4]  240 	ld	d,a
   013D 1A            [ 7]  241 	ld	a,(de)
                            242 ;engine/tile_chac_chac.c:61: if (rdm == CHAC_CHAC_BOUM_STATE) { 
   013E 32r00r00      [13]  243 	ld	(#_rdm + 0),a
   0141 D6 03         [ 7]  244 	sub	a, #0x03
   0143 20 12         [12]  245 	jr	NZ,00110$
                            246 ;engine/tile_chac_chac.c:62: shaker_ct = 8; 
   0145 21r00r00      [10]  247 	ld	hl,#_shaker_ct + 0
   0148 36 08         [10]  248 	ld	(hl), #0x08
                            249 ;engine/tile_chac_chac.c:63: PSGSFXPlay (SFX_STEPON, 2); 
   014A 11r00r00      [10]  250 	ld	de,#_s_15_stepon3_psg
   014D 3E 02         [ 7]  251 	ld	a,#0x02
   014F F5            [11]  252 	push	af
   0150 33            [ 6]  253 	inc	sp
   0151 D5            [11]  254 	push	de
   0152 CDr00r00      [17]  255 	call	_PSGSFXPlay
   0155 F1            [10]  256 	pop	af
   0156 33            [ 6]  257 	inc	sp
   0157                     258 00110$:
                            259 ;engine/tile_chac_chac.c:65: rdx = chac_chacs_yx [gpit]; rdy = rdx >> 4; rdx &= 0xf;
   0157 11r00r00      [10]  260 	ld	de,#_chac_chacs_yx+0
   015A 2Ar00r00      [16]  261 	ld	hl,(_gpit)
   015D 26 00         [ 7]  262 	ld	h,#0x00
   015F 19            [11]  263 	add	hl,de
   0160 7E            [ 7]  264 	ld	a,(hl)
   0161 32r00r00      [13]  265 	ld	(#_rdx + 0),a
   0164 07            [ 4]  266 	rlca
   0165 07            [ 4]  267 	rlca
   0166 07            [ 4]  268 	rlca
   0167 07            [ 4]  269 	rlca
   0168 E6 0F         [ 7]  270 	and	a,#0x0F
   016A 32r00r00      [13]  271 	ld	(#_rdy + 0),a
   016D 3Ar00r00      [13]  272 	ld	a,(#_rdx + 0)
   0170 E6 0F         [ 7]  273 	and	a, #0x0F
                            274 ;engine/tile_chac_chac.c:66: _x = rdx; _y = rdy    ; _t = chac_chacs_t1 [rdm]; map_set ();
   0172 32r00r00      [13]  275 	ld	(#_rdx + 0),a
   0175 32r00r00      [13]  276 	ld	(#__x + 0),a
   0178 3Ar00r00      [13]  277 	ld	a,(#_rdy + 0)
   017B 32r00r00      [13]  278 	ld	(#__y + 0),a
   017E 11r00r00      [10]  279 	ld	de,#_chac_chacs_t1+0
   0181 2Ar00r00      [16]  280 	ld	hl,(_rdm)
   0184 26 00         [ 7]  281 	ld	h,#0x00
   0186 19            [11]  282 	add	hl,de
   0187 7E            [ 7]  283 	ld	a,(hl)
   0188 32r00r00      [13]  284 	ld	(#__t + 0),a
   018B CDr00r00      [17]  285 	call	_map_set
                            286 ;engine/tile_chac_chac.c:67: _x = rdx; _y = rdy + 1; _t = chac_chacs_t2 [rdm]; map_set ();
   018E 3Ar00r00      [13]  287 	ld	a,(#_rdx + 0)
   0191 32r00r00      [13]  288 	ld	(#__x + 0),a
   0194 21r00r00      [10]  289 	ld	hl,#__y
   0197 3Ar00r00      [13]  290 	ld	a,(#_rdy + 0)
   019A 3C            [ 4]  291 	inc	a
   019B 77            [ 7]  292 	ld	(hl),a
   019C 11r00r00      [10]  293 	ld	de,#_chac_chacs_t2+0
   019F 2Ar00r00      [16]  294 	ld	hl,(_rdm)
   01A2 26 00         [ 7]  295 	ld	h,#0x00
   01A4 19            [11]  296 	add	hl,de
   01A5 7E            [ 7]  297 	ld	a,(hl)
   01A6 32r00r00      [13]  298 	ld	(#__t + 0),a
   01A9 CDr00r00      [17]  299 	call	_map_set
                            300 ;engine/tile_chac_chac.c:68: _x = rdx; _y = rdy + 2; _t = chac_chacs_t3 [rdm]; map_set ();
   01AC 3Ar00r00      [13]  301 	ld	a,(#_rdx + 0)
   01AF 32r00r00      [13]  302 	ld	(#__x + 0),a
   01B2 21r00r00      [10]  303 	ld	hl,#__y
   01B5 3Ar00r00      [13]  304 	ld	a,(#_rdy + 0)
   01B8 C6 02         [ 7]  305 	add	a, #0x02
   01BA 77            [ 7]  306 	ld	(hl),a
   01BB 11r00r00      [10]  307 	ld	de,#_chac_chacs_t3+0
   01BE 2Ar00r00      [16]  308 	ld	hl,(_rdm)
   01C1 26 00         [ 7]  309 	ld	h,#0x00
   01C3 19            [11]  310 	add	hl,de
   01C4 7E            [ 7]  311 	ld	a,(hl)
   01C5 32r00r00      [13]  312 	ld	(#__t + 0),a
   01C8 CDr00r00      [17]  313 	call	_map_set
   01CB                     314 00113$:
   01CB DD F9         [10]  315 	ld	sp, ix
   01CD DD E1         [14]  316 	pop	ix
   01CF C9            [10]  317 	ret
                            318 	.area _CODE
                            319 	.area _INITIALIZER
                            320 	.area _CABS (ABS)
